let input = "
PnJJfVPBcfVnnPnBFFcggttrtgCrjDtSjzSS
llWlLbmmdLLwLbqGdmTmbZfCQtzrMQfrjSzrtSrMqgMt
sHlZTsWZwGGlZmGTmdlZbhJNRPphVfRvVnRBsRsJJV
fsHtVbjtqstBghhwwPBw
SDQzzSzQrQMmmQlmlcNcJLZPgLrVZTdCddhgdPwwCw
JmSWSVGGlJJbRsbpWHfbRj
tJndRtwtddPvllvfrldrfPpHWDgglFDWWmMmHWmHpZlS
BBJTTjCsJWZCmSHSZD
LhqLcVzshTNjhqhcjLLTLjbTnGndfdwrfPRVRrdnwftQwJRv
wHlPJZwbbZfqbFwqFZfrrcrJrtMWSMMVtVcJht
NzzzNBjNfLzvGfDNjMhVhrrMShLchsRVLs
DDdmmgBGDNdgfgZggnZbZHln
jqNjZJqsGsRqJJqnlJJGzMzffcffTCfQcFmvcWfvTNfcvv
PdhVdrwphhVtDdSPLmFCWTLFWWTfFQQr
dSPwbbVdbpQllZMQbMjM
QQdfflqvjTvfZqLMWfNDGhwsCNGGGM
rzRRRTVTPTNhsDWDRhGC
gHSTpTnppvjQgJjcql
nzNvsFBBBFsNrnNBrvndfThwDbhVPzVVwhZZChpZPCbZ
GMQQStmcHHmlfMtPwbZVVVVhhPhbVc
GmSmMGlmWWgqQMHgQHtSvTNTTrgBBvNvFsfTfLvd
VNVBgRRBRzWRRbRTrTBgbzpZvMvMJlQJZJpJvlTMdJlp
mfdfdfdHfQplZJJh
ttnPmsLHmqsPGgWjjWRbBdbbGj
mMMzwFFpnwgMggSzhQSbSJbhWzbr
NPRlHHPbPRdPHCdRNGWWhWQhJVVGhZrCCJ
LlNbRllLLdHnpLgMTgTsDT
mWhvwmthrzJrLhvftwPrtNHlbcHgbDzNDHcGgzllHl
TCjdSCFMQCCCjMspCMQBMqpFHNGblPPnGNNbpnpccZGccclc
jVBPsqdFMFsTVMsdMmfwhwvVwLrvWhVtJR
TdhJJttgmdgctBBhBwBqBCLWqC
fjNGPblpPlRDfsfGbfcWqBqwWvnHVvBLVHss
lpRNDGjbrGfPZbmZZMFdTzTgcFdS
WPLMvWLMqLcSvrrBmDPFfRzmDPRfZDHP
dCggNCCdNCbHTHTfFnNHzM
GlJVQjdCCwjMGbGpjGdCpqrtctqcttchsrLLcthlhc
jgPHPgjGCwrqjqrvzBfFfCTTCdFpDD
QhQLtcrQQLWshQttdzzvzBnhvvBhvFTv
RJRssrQSWQSqjqqVSSGP
sPszmnmnQPQbjSRVVjbRjVVB
cdvZqMfNchMMMqCBlBZlmSmWCHBj
dFFDqJNNJvTJTqvvwmGQsGwJztgrwsts
dJGPMNStSclWJSPScMNMzqqDfzqVzwwjGfzjqfQz
hppFbrhFrrhgCpFlFhvFTgrsDfsjVzvLDfqwVzzwQDsVwL
RrgnZbphTpbgrnZgmpbhFcMlnWdMBNWJdtNJBMMSMc
HqtfLZCLmLtrSqZStzFtwpPQWlNQBpplpQWmBpNp
jMJcnRFcJjvjvcGvdJpBppBwQBpwQWPW
DcvDgbhjMMsjGvcjRRvjvgbGtsTZFHCCHSCHZHLfsSsCSrZH
wvFPFqvjlgTwjvjZbMSzHTSScMBBbN
VVmpVsmmptfDsdSZbMzZzMZBtB
LVhfGJVhQsWhVJhfmGJMwljFvqWrlPvCqrqjFFvj
cdNbtwrtwrRNLzhQhHfCzbGzQH
DMlMgFDBMSBjMTqMFWMFDQHdGZHvQdTHHvHzHChJJv
MBVWDngVqVWlqqBgBjjcsPnwnNdNsPNPpRcLws
pQqHsBmmrQHrrmsmmpwMdfdPbfWPMVbMdWbPwG
ZSvZDlvghgSDZCSzJZzgZNNPFRFMVRVfMdbFPddfMzGRWR
vWgJhSntvglSgDCHsjHBBpnTrTmjmB
hDgmmgnwDCdddRCqCPzz
sSslHbctbHsNrhpZqdqprc
WbsHSBQHQBLHTWJSlmjnVwFDvWhnvjmfgv
phwdhVLRddWJLVglLWRlWWgwhCjCrrrHZmCjZNHtjvvZrHTN
zzFzPQqFDcFsHsFPHSsGSCCNmftjjNDjCfCCCNfvrr
BSQsqFQMcPqHbcGzFMWgLlgwpLlpJLLpBwnp
GTrsHGGHfGMvsrGsvnGcHsvTwhghwhpVpJhQpwhQghhmmm
bFPFPPtSdPtSZPZWjSdZSNFdmhDJQgRQbQgmhJgJmRwVQMRh
jPdjldqlSNBdFBjtFZsfsGMqsHCMcqcfvnrf
crZHHZcZZsSrVrSCrBNTTpppBpJBCbwbBn
DzhRggfhhlRghmBNBpLJwDpDDTNp
qvwqwPRfvfzPPRvQlfPvPlRjZSHZrcScWrtVQscjjtZHMS
GRGBgsgghbvRvgsBTsgRjjznCCtSVCZtCFZtzFtwnSdj
cmqpPNnWWPrqWHplHDDcpCddFfZdFtdrwzrfdVFFdt
lPNPNPcqpcHWmPLllDDGhbRbnMgLgRbvRsbhhg
ZRBBNFWWBWPDZZprnwVvDD
bSzzhHdttMtCCzCThMTShStcvrqNNjwnrcvqvvVVpprvnnpN
CStdTMLztMmTSSMTSSSfBQNWlsFRJRPfmlNRNB
pMLptvGHTSGSHtLLwNWvcqsJmWWzmPFFms
nrQPrjrddgQlDPZjdlBcFFzFsFWhqWgshszhNW
CZDCQjjBBjrnCfQCrZrbSbHLRwGftbfPbHRMfp
sqQHBqsHbwDtmbSB
GjVGrlsMsPjbPbPmTtSwDb
lzFFGznLGGrLrnrVzMzsqvpqvWQcnNZWvCpnqpHc
nZWZjdWRwhRdBRhhdNZMtHtpPrGCCGsrTGsG
DzFFbblvbzFvVJzzzlVmvlpTpMpMrMCgGMtprJgCMrPM
zVmFzFvfzSmDzmCmzmmVQwNRqdRhcWBqShjqNndWWj
QQTdgLQlhGhQdPbwJJgwRVmtNRBV
vCSnjzFqSDDFMDjvrqvjvnVBRsNJRpJwtNJNpNrtbtbt
DfnCCjDMzcnqvHZGlcTcZThBlG
lWtmssWNcBjTjhlLpn
fwJbgfQfVfqPwmdgJjppHTjCphppBHCnhV
bgvfmvmbqdfDqJvqgbPJNDNSMscNDtccDzzcNtRt
ttBHSflTlqwGGQJBQq
jvdPdPLsDvCzvVqVQQGw
ZDdZnPrrPLPLZMZlfWSqmmTWmtTMtF
ShhwCZSwlPwZPSplwlRGGVmttWVVQcJVnJtSJVLcjc
qmzDmgNqNfgtJWWqtQLJqL
rsFgvrmFdfRhPBRvRRPZ
RQQRGJRpfJzlTQmbfbsGlsTMSHMPgcMFpgqPHHpHqqPpcP
WmLZDBBLZLNVdjWqDCFHCMccSPgSgg
thrNBVVBrWZNBWNrRGQbRtJGzlRRbmlf
NfdjBfsnDfNjfBddNBnBwsQShzQDhSDhvZSRDpFRSVFQ
lHrbTgtLmrblPzShhRpvRPZPVz
tWbqHlHmWHgWHtqrLJJsvBwnBfjswjwnNMwf
qQfdCVqZSqZmQmgVqCqCWTMcNFTwWwTccgpcWcpw
nSLrjrJnLcTwLNcz
sjRjSnJnRsBlPtnqCqCGfCbmQGHfCl
tqSmNPNcVrNNmPtHfMZbCWMCZbHwfdzW
RwgGvFwFdsssgjdb
LnLhhnFDStLJSrtw
HHGCHgfjgjgzNSTgJTDJ
WdMbDBdQLLZPWZVZZmLdzqqNbvzswSzrqqsJwSNw
QQmQBmWQZBmRPGfRjRcHccplpD
zFpjDvzDzWWvWBqDqvQcjsfbHPjHsVjcPGffGc
TttwldmlTPSCCZmhlNggwffhHsshRsGssRsfGHRhHf
twmMMmltZdNNlZLLMrPWzrrprpDr
ChCnpqhzCdndsDCnVpVJBgLTpTtgVggL
swHPGmwHbjPjvjQsGLSgVMtgSLLTVBHSrg
mRPPwvbvbvQjljvbPvPlfwWhsnhZDzFnWhDFdWcdhZWl
ndnSZSfNgmmSZlbllglVVsBCfqFBfttpPFtsqV
DJwcMzJDwLcMHMDRMRrtVWFWtCBqBWpWCzzP
wvcHhRcTJJvTRLRvRhwTQTHdQjqqGdgnbGQgSbqSbgNSdl
MHtvCFtCFvMvBDcVfjhhQf
WJZWSgZbdlwZZsbTbwDhcBVQhmTTTcfRjmjD
WwwrBwZsSJWwFttnLrMCpntn
BJgWJVSPVzNJNPZPVHBJHBfdhbjDnbQndnBnBQfndQ
MwMsNmNpmsrrwLssvsvpRpvQnCqbCCQfCfhhbDnqCfqLqn
MFvtrmGMFwRmFvcvMFmsWSVHWVHNzgZWTtWSTPSZ
wWNsHswfsWnVvNZvMLDRRpcLMBDnBlpR
QFdhqzFbzmgbhzQhFSLRrpBBBRcRBcLldpWc
SbmhzChGhqgQFFzqGJhwvtvNWCtVjVfwwZjHjT
WHGDHBRQHDBBQpGzBzQlDVjPmmVtbqbLmtPtzvmZbb
nchMhdMgCMJcwvLZvVcffjZfmq
ndhghggCwSnhCnnTNSdBpFWQFNLFlpHQpDLRGl
FZdjbqjjZTFbRHfVwgttfBZrBpBB
LJQFJWhPPnQJJQCPQpzwphczchrgtrfBrf
FFWvnlLGDGRMDHjm
jCsCNZTTfjcQMLWTtvHQvG
mgwdznllpRgBgpBDdnDDzBDmdrMHMLjtvvHJtLrWrHQWvQtv
lgjDpVSppmqsqssVPZPf
NcNwtChhScfPtwVRgmvWvWvNllVg
nZGJMJLnqqGzLzrGQvlmmgrTmWWlcVvR
LLdMzdssLZnMMbbZBJGsqLcjwjwPffpdtjFpFhPdFwjFFD
wQvZHfbLjrMZSVWMZSdZ
wwqhwtTRRpCCMmsnVlWGMpWM
qBDcqBTBtJCBDqctRDCBCzDFLfbfLwvfbQcFHNvLvvfQjQ
QDFwwvLJFjWQvWgGNnfNftCJPggP
lpqdpqqrqBBpTTBsprpsTsbrNGPfCPzftfPMMGztfzNgNflM
sqdpHrcbmTTHTdcspZNbZmDSQLQjhhSSWwvWWFHQvLLh
gjQHjfqgVSqjqMSnCRMDMvCGZDvCNCNJ
FnLswmdphJchhcZd
bslwFmLTTbWWmlmbBLwlpBHPPBjqHjBSgPSSSfrVnzqQ
JddrdBgJpChGfDLDDpcm
WnSFqRhnjjWSSlSFWqTFVSLGbDLcbLDDvDLztbftVzcv
nRWjsRjQFnQRshgwJCZwJrhw
rnbZwrcZQdpsLpHDVWBBBgDv
NNTSFCqJFMMMSJqTFFPttmNPlwgLvWvgWBffWlClLfvlVCVv
TMTTJSJFRNwmjZsnGsrhnZZR
CMZhZstZqlClJScfBrfHHHFWFFHh
RwGdpjdGVGdmNHcfczpJWWpf
dDJnQbdnwQdbggSPgPsnlqSn
hnczBfznJFmzhnzJLLMwLjmQrppgCjqC
HRRlrPRZSDtQjjPQNMPpPw
ttlZHDRGRlRtGltTtGvcbnFrbvWJhvWhndcFWF
hRsCqfRdqdqfqdtqmMmmZpStMTZZSTnp
VjDDjWbzPFFwPRPFDjzLSnTMnZSGZMnWpLLmpL
PVHFNBzDRbDwzjNNzHdvdHvlhhcHgvCglf
cRLLzhRBhLhVLLLMnnRVVhtJgNgPJmPgPvDPJgvzvvNJJP
lpFffHHWHbbMNPQgsgJJmW
lpdplSpHSHlCCTbSpSFwdnLqMwcdBRRRLdRnth
csZWwFFZbtbztcZttbnRbGlbJhqfnhlpnn
mmTjjBLdSMQdBggQHNgTmjgJJRqRhCJphRHRRClGnhlWJJ
MNMMNTmBLDmTLDSQmFDvvzwPWzsvDZFFcD
fmflRfGcCtGDDbRCRlhCmmBJQsvBBWWvtWBnBJvLLvLn
GFjdMMFGzVQvWWVWJQVJ
wjTZzjrFTHgZjTFjMwGRcfRcqlbhcccrcmmlqC
PvnvjHPnjRPPqvvnPqZNNWHTSdVDHwTLSDWDlTTTLl
MJswhgppwspJpJsGbhchbcMlLLDQdVSgVldtSlSlSTdTld
FwzwJzpfzzJRPZmPBvvmBF
ZrJhslhhclDJhrDZllcGGrZnFCCWNMCHfsFbPddwdwWwCCfP
BTjgvtBBSLqqBSLVzgTpBVMFHNPHwFbSwMPbMwbHMCPf
fRtTppTjRJmrmJDR
hJzcQcwMQhcQwZHVNmSmPCQZSm
tpfvgWFFGGfRWFBqtPrHCmSwPPVPwgVgPC
fpWBRqWqqGRpWWRpFWssMnLczJnnwcjscsJnLhbz
HggzqvvrgtlrrHlQtvlJqFdfBLFJBbnfbBBdfBBfFd
SVVmpZVsRLZGGZwRGZSTDWBbmBFBdFBnnFCnWnBfhB
wpjVppVpZLRTGZQrrjjHNzcgvjrg
GsMgMCFGMsbwbbSwwglS
mJDMqRJzTRVdPWttPffZppBBfS
dzcdqQcmQMGnHCsQ
HlPgHwlHVwsVPPFVsNwzwLnmRmCCMcJcMRRLqGtRjCjJ
dWhrWdDnmrrRMRct
BZDvBpfTDDfBddWTZhDddWDQgwsFsHVvVHgHHznFQFznlQ
FjmqFqJJGsBGGhsZdRDDRZZjTvdMdt
NnHPngrPbPpbPfVvfCrnwccTwrRwTZdcdTZLwRTD
lbbPvHWlHCNNnJzGJlQsJlsBBq
mLNRpRDcDDCmCpzTcCPcNTTDrrnrPrPvjqtqhnhhhqQQjrhF
dVMlVGgVSlGgWgsWSZlwtrHvqMjhnrhQjnBBqHqvhv
WJfsVwZfJGfdLNmcmCcCtztf
bBTtWQDMpDSjjznztCLd
JhfZfrNPPwNJrhqRcJjfCCCzLSGLbGGjGznj
RsPRZhwNbgbrgbBpBWWsQFvDMTDF
rqLzTmqqMmmwrqwrJJwPTplhbRDphhdhDvnnhnRDnP
ggfctFfSRNgZFBRVfFfWfZNSvjjvjCChpDhhDCCjdvlDDD
NQfFRFgtffcGfcgZcfBqJrGLJJqLTwwmmHJrqz
WVGJCltslWJsbbtNJbDJPMrPLBNLrpNjfqQQMMNr
nTFnTmdRnTmmmdHZZnPQpLMfMZPMPqLZDqLf
HRvRFRTvvvRmnvFcFRndcwVVJWWGbsJGwgttlCzJlGDg
rfwdfLwLwwNdwbLcgCCTtFPvFPzWtWVtzvJF
MpjqDDQQRmQjDspzTWWthVWRvRVRzn
ZTQQQqlQZsqlrlgwNlgLcSdf
QqBNgbNNJvcgnbBQQgJjQZSJWppPWsGpDpSGPpWTRDTp
rrldddlrChLFpWPSSPWvPGCR
fhFltdLhHwVfvgcZZqjzNNtQgt
BMCMQZSMvSZSQTQTWvMSvrrTccgGRNljBFglGRgBVgFGRRGc
ffmdmwdLbDJwFVNlGRRVVbRR
dwJnJLfJwLhnPQSSNMvMqhMP
RpQDDCHQwMRpwpNMCwpZhgZrPSqQdgrqPqPZqq
zbtzmzzGbVzJSTScZqrthddT
LVLJlLBnGnWNHMDRHnCCDh
wQDcLhScLLBStHhctwVwsBjNTrssTjgNsgGCgssj
fWblbRqMZWRffldFZpqWRbTCsPrsTNgnCQjgTrMGGgsr
FZRpqdlWWbZZJJJppWWdHQVmLLDmzwDcLSVcQJLw
DlllCDRlflQRsRnlCCBhzvLFVhJzJVzh
jHjNNqdHqwNgpgqNcpgZwjZhJJbvdbPVhBbbvVvBvLzbPF
cpcgSwWqgVnftSSTTf
QmLZvjwwmDWFLNLqbqfF
JJSBMBpdpgSBRBHJgdHBNVbsgqVlqfbVFVlqVFqb
pCttfdCRMDCjhPDhmQ
nDjnzdcDbDtGdcQTvssHssHbbfTq
lVgRgpWCrMRVgVglRLjJmQFHqHHHsqFvFfTQsHSfMQ
VrlpmWmgWppllLpPPWPWljPBntcnhdBNPhZBZhGdDd
fQsRRfBHvRRjjvSgTwCTphdlphqBpn
WJrDZbrNJZPWJcZmWLrrbPczpCnTddqdshqhDgTTwlwwTqhs
brcPbZPcWGWssGtVfVMjFF
GBZgqHhHGBZcLcGMjVJhrjrbStjbbb
wTTNFPQpvDQTQLQvntRSbRJjVnrSDtJV
TTwzQzPPTvmWLTTcdWfdGdZgfZHfZH
VswNdtMgdsvQDJgdVNgQrrLlhrSCLflqfLrDnzLL
RbjRbcZGTGpRbzrTqChtflhSnt
mBjPRWpGcmBZGZpmZjtRbQQVwJgsPsQMsvNJdsVFdN
TDmDTTThRDbbZtpTSnhRcFJMglldGdrJltgBMtMB
jNjsWLqqqvzWswNqdccrFNBFMBlMrdMr
LjjqwvsWCwjHwQHHTbDHbbRZmnRd
qtnncCFCqjwjcDwnFQSGGRSBGBSvFdvrhR
JPZzpgPJWNJBRhqSvQvBgB
mZmJmMPWzmWmPLbmqTTJPfDHnHjCjflHjflfDcfMwC
VfJrplTqzVVlVVlpfTMJfqDtWSLgbHgDjSHLgjHWjrjb
vhGsRdsNRPRvvRhjSZjJLPDjDJttbZ
GvGhQmhBnQNmnJGvhdFqBFVqcllqMBCMlVCc
cnmsmmDCBDmcmvVnsVBtQQWWrrltQlrBfRHB
hqphjLZFhMMjZQGQWGfftQWf
JhFqhbjSLjMpqzJFbSLdFSggDwgmgcDVsVzVfvNvDvsm
mRdspZZggmbJbpDcDJDqPhvvGvrnVqPqpzvVVV
dSjSjQtwfQlLwjQSPrrqVqvGPGPVPjnP
fMQtFQLHSfLtHFttHMflfwHWgFJsDbmJRDWdFBRJWmcbsJ
lMMftpGHMntGtMMGpJnSPQvwzvvHscsdQscQsscQss
hbfmWWLggVFjVVQdvbQvbcdzwbRR
qZWFWTgTZhrLhLmWGlGGrSnJSNfGtSll
QVGdmgVGLdllrGVgnZrdBvNvBSSjSvWtBHBqNNmv
ThRjRFwpfTNBBqSBSSvT
MFzbzfDjFFCCFJpRpFwbwJRnZndDgsZlgLrQLDgdlglZnD
PjbDQvQPjbjjvtrQcpHBWnLfqnqGcHngnLdf
VTwmMzMFnqHBwHBB
lMTTNCzCZmClVVQjstQpPlprlHSp
MtMqBtwFFsMRZMMZMjJGZR
PHbpbPqHmVVCRGGCGRjv
pdrrgdrqPbpzrHQbbqQPLHcQBsNtNnwzNhSFfhtfffFffwDs
cPjpPcRJJVtSGGtJtffN
CldrWrmDHnHnmWmTWsNzzfbbFNhtsbbNGGfb
LCDTldCmnLLVwPVgQt
NJpFrbpFZhlzhbzzqCtgMCgRbqCRMMtm
dWcnntHQWcjRHHCVMqCsRg
vLnQDvnGptrzLPwp
dwTwTHwvZHqTrTRTlWtfzt
GbFFbFBPnGQBQcQcLbPjFtCSrtgMMLrMfrrWgRgStr
PnBnQhsGPQbnJRqwdRDwvJNDwq
zzjWtnQRntzSBjZccmZmmC
bdJdbdfJdFCGflfGwBJsmhmSMgmgcsmM
qDbGDbvrFbbvGdvdffFdTTWQzrTWTLWLNnttLnCH
WMMssTqCbpGzGSlmzLbG
FVdwftRRVDZPcdZtZVRcjmvQSzzLrmlrclSGms
DVfPFZDZRfVFPFHRPFRCphhMpCTHTsNgqHNWgn
LzBGCRjHCnmnHzdzLLjHwGplflfrfPcgtflgLFLlcrcc
hqhDMSSqWZsDMVWTVWmTcglglflFVflFrpPtggcv
sshbJsTsqWMbqNWbhbzzjzGBQjCJQnzwmzBw
QnpfLpbLfGbvgjHzjgmNRqbz
SSMBMZDwMwFsqgSPPmHlHj
BhMFJhMBddDMFcTdMVddrQfvrnCqnCffpqnVCLtC
lhrTZNJZjCRjSCvRSlTSLlrvFnMHQhVDnqnmqqqmQqPDHmqF
wcpGdtwtwzcbpzggCFPMqtMQmQqmVqHP
bBfwgWbfwBdGpppGGGbcBsTRLlZTZsTRTsRNZClJsvZL
nJLgNcQDNMlQHMvCbv
zphFpmTszmwhGGFhhtppNfffVlvZvHCCVZzbfzvS
mTTsmTRGstsFhWwtWjPRdjnJdjJnLjcLNd
MfBDjllflHLTpDhhppDDbp
NZBBnGJNnNPWTcTTmVhZCh
PSzgSgwrnzrSzBGJSJrSLQqfMHQfqgRgfjHLljll
RgbNmBbqgWHWRNRqHtcMlMwJJjcDtVlD
SzpFLGPddSGnnSLQZLtJJcclDlVjDQwMhDcc
LtTZCTttRqqqvqTN
";;

let lines = String.split_on_char '\n' input

let split_half list = 
  let rec aux list acc =
    match list with
    [] -> ([], [])
    | h :: t -> if (List.length acc + 1) = (List.length t)
      then (acc @ [h], t)
      else aux t (acc @ [h])
    in

    aux list []
;;

let explode str =
  let rec explode_inner cur_index chars = 
    if cur_index < String.length str then
      let new_char = str.[cur_index] in
      explode_inner (cur_index + 1) (chars @ [new_char])
    else chars in
  explode_inner 0 []
;;

let rec map f t =
  match t with
  | [] -> []
  | h :: t -> (f h) :: map f t
;;

let bags = map split_half (map explode lines);;

module CS = Set.Make(Char);;

let pocket_to_set pocket =
  let s = CS.empty in
  List.fold_right CS.add pocket s
;;

let map_to_bag f b =
  let (left, right) = b in
  (f left, f right)
;;

let map_bag f b =
  let (left, right) = b in
  f left right
;;

let sets = map (map_to_bag pocket_to_set) bags;;

let dupes = map (map_bag CS.inter) sets;;

let chars = map CS.elements dupes;;

exception BadChar of char;;

let char_to_val x = 
  match x with
  | 'a' .. 'z' -> int_of_char x - int_of_char 'a' + 1
  | 'A' .. 'Z' -> int_of_char x - int_of_char 'A' + 27
  | _ -> raise (BadChar x)
;;

let vals = map (map char_to_val) chars;;

let rec sum = function
  | [] -> 0
  | h :: t -> h + sum t
;;

let total = sum (map sum vals);;

let () = print_int total;;
let () = print_newline ();;

let rec split_3 = function
    | [] -> []
    | [_ ; _ ; _] as three -> [three]
    | h1 :: h2 :: h3 :: t -> [h1; h2; h3] :: split_3 t
    | _ :: _ -> []
;;

let lines = String.split_on_char '\n' input

let non_empty_string str = 
  String.length str != 0
;;

let lines = List.filter non_empty_string lines;;

let sets = map String.to_seq lines |> map CS.of_seq;;
let groups = split_3 (sets);;

let rec collapse f default list = 
  match list with
  | [] -> default
  | [v] -> v
  | h :: t -> f h (collapse f default t)
;;

let dupes = map (collapse CS.inter CS.empty) groups;;

let chars = map CS.elements dupes;;

let vals = map (map char_to_val) chars;;

let total = sum (map sum vals);;

let () = print_int total;;
let () = print_newline ();;
